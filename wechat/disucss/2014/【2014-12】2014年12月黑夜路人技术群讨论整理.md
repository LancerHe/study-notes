> 转载自：<http://mp.weixin.qq.com/s?__biz=MzA3MDA2MjE2OQ==&mid=203539713&idx=1&sn=3ed1fee6ddf7b48b326fa5225c8471bd&scene=1#rd>

1. 硬件配置性能、吞吐量，runtime性能优化及实际测评，业务的压力测评，这些都应该算承载能力的核心内容吧，经验很重要，测评也必不可少 - 刘卫涛

2. 可以看tps qps以及对应cpu,内存，io压力 - 泉-June

3. 进程数与物理内存有关，我们这按每进程最大2G内存计算，单机最大进程数＝物理内存×0.9／2. 线程数则和CPU核数有关，每进程线程数＝CPU核数×1.5. 这是经验值，不同类型的系统是不一样的 - 水浸街

4. 对于新系统的承载能力评估问题，最初总是按照压测+经验值来评估的，压测可获得单机的满载TPS或QPS数值，然后除以机器的tpmC可换算得一个常数，再乘以全部主机tpmC即可获得集群的满载容量，一般生产系统是要预留一半的冗余的，所以获得的结果还要除以2. 我们使用TPS，互联网公司用QPS多点 - 水浸街

5. 之前看过一个文章，说uptime的，有三个指标，0.7  1.0  5.0三个临界值，0.7前后需要调查下，防止进一步恶化，1.0需要马上解决，5.0意味着你将失去睡眠，半夜三点也要起床处理。长期每个处理器的平均值 - hello

回: 你说的这个文章是阮一峰翻译的那个吧  其他文章说的阀值跟这个不一样 跟具体的应用类型有关 - 不如

6. 我们是传统IT行业，实际上TPS、QPS只是一个中间指标，最终要的是系统的“承载能力”，这个定义太抽象，所以需要一些实际的指标去衡量，因此就有了TPS、QPS，另外还有PV、用户数、活跃用户数等等还有很多指标都可以衡量 - 水浸街

7. 问: 一tps中的事务是指什么? - 陈一回

回: 不太清楚，网上说啥的都有，按TPC委员会的定义应该翻译为“任务”的，就是站在客户的角度看执行的任务，不管你一次任务有几次请求 - 水浸街

8. 问: tps不是一般指事务执行么 - 黑夜路人

回: 对的，一个事务里，可能需要多次请求。tpc委员会有一套标准的tpcc规范，所有基准测试都用这套规范来对比就好，当然这个只是理论模式. 和实际的，肯定还有很大区别. tpcc更多用作基准测试，比如2套设备间的对比 - 叶金荣

9. 对于数据库来说transaction翻译成事务应该是最合适的，而对于一个商业系统而言，我觉得transaction使用本意“交易”或“买卖”更合适一些，因为TPC的测试模型就是站在客户的角度去描述的 - 水浸街

【12-04】分享下CDN、内容分发、云加速的使用经验及遇到的坑 - 刘卫涛,蜗牛

1. 有些cdn对文件下载线程数有限制，存放下载类文件，要测试一下 - 徐刚

2. CDN的问题.  上次发过一些.  再来说 1\ 在动态加速中,CDN节点机器双次回源导致验证码工作异常. 2\所有人都在用的公有CDN节点,被4层ddos攻击, dns调度需要时间, 你成了无辜受害者.
在自己部署自有CDN不经济的情况下. 选用三方CDN,看你vip待遇如何了. 百度云加速这种,鱼龙混杂,节点挂的真是太稀松平常了.  所以我发现用户构成也是非常重要的一环.
突然又想到 阿里云了. ucloud面向企业,用户素质高一些.  阿里云面向所有人.   杭州目前的空闲ip 都被ddos成狗了.  我开了杭州的一个虚拟机. 还没开始用就 说被ddos了. 一看统计, 都是超过 他免费的5g防御.都到黑洞去了.  连续给我换了3个ip 都被经常攻击的ip ,多的攻击到了20多个g.   最后给我退掉了.  然后买的北京机房的 . 汗~~~ - @理鱼

【分享链接】
1. 20141024程序员节分享：一步到位实现MySQL优化的PPT、录音、视频观看地址：
微博微盘：http://t.cn/R7xBs2d
搜狐视频：http://t.cn/R7xBgwz
百度云盘：http://t.cn/R7xBs2e - 叶金荣

2. http://mp.weixin.qq.com/s?__biz=MjM5NzAzMTY4NQ==&mid=200910426&idx=1&sn=dd14fc0df2cc5296d07cb1b515b91a5e [MySQL FAQ]系列 — 从MyISAM转到InnoDB需要注意什么 - 叶金荣

3. http://mp.weixin.qq.com/s?__biz=MjM5MTQ4NzgwNA==&mid=201723209&idx=2&sn=a36575ffbd48c33fd4c2e547f15183e8 腾讯数据平台总经理深度揭秘腾讯大数据平台 - 黑夜路人

4. http://mp.weixin.qq.com/s?__biz=MjM5ODAzODgyMQ==&mid=201226288&idx=1&sn=dd29521c31f2403b1263a9cd9da1d2dc [今日头条] 国内唯一一款真开源项目 SOHU-DBProxy 已释放 - 黑夜路人

5. http://mp.weixin.qq.com/s?__biz=MzA5MTE0MDUxMA==&mid=201694838&idx=1&sn=95c987d8c479fed9006fa84ff0084022 为什么社交网络中数据翻页技术复杂 - 念念念恩他爹

【12-08】讨论下春运火车票系统如何设计架构 - 黑夜路人

1. 感觉了解春运火车票系统设计和思考，大部分秒杀或者红包之类场景应该都能搞定 - 黑夜路人

2. http://www.chinaz.com/news/2014/1205/375892.shtml 前淘宝工程师谈12306：做它比做淘宝难 - 黄垣华

3. 12306应该不是实时动态库存的，春节时不管放多少票都不够，因此一趟车在哪个站可以卖多少张票必须要规划好，从哪个站下车也是有限制的，避免一些短途车票浪费资源，第一波票卖完后计算剩余有什么票再放出来 - 水浸街

4. 关于12306的库存，我有一个想法，还不是很成熟，大家可以一起来讨论一下。比如一个火车要经过10个站，3种座位，每种座位都为10个。如果按站点做为商品来处理的话，其实总的商品数量9*3， 最后一个站当然不用卖票了。每个站的库存量为3*10    一个人从始发站坐3个站，那么只需要去减前2个站，对应座位种类的库存就可以了。
淘宝这个技术是按上下车的可能性来计算商品总量，所以概率算出来的商品数量就会很大了。  而且要组织这些商品的有关系也会比较麻烦了，如果按站点来计算商品总量一下就下来了。  按途经站来算库存。 而我思路是按一个站点，最大可上车人数来计算。 - 陈周瑜

5. 据资料，12306 是用的 甲骨文数据库， 所有数据放内存， 内存群集用的vmware公司的方案 - @理鱼

6. 前几天看篇文章，就讲火车票系统到了黄金周就是所有商品都是秒杀，所有商品都是动态库存的变态网站，想了一下，买一张火车票，所有站的库存都得减一，这数据库使用频率，估计也只能堆服务器了- 酸酸哥

7. 如果是库存更改影响多个数据,那就不应该放数据库了. 库存数据应该想清楚结构,扔内存里. - twin

8. 我猜测他是有一个随机数像抽奖一样来决定谁能真正进入到抢票环节 - Rex

9. 这样的系统,一个重要的功能是过载保护. 当大量用户涌入时,至少有小部分得到服务, 剩下的用户等待 - twin

10. 减库存 我曾经想过最小生成树 - flea

11. 每个车次每个站有多少票额是固定的吧，如果是动态的，必然造成部分站票额少甚至没票，公平起见，应该是预分配票额，这样逻辑要简单点 - 徐刚

回： 不固定。 - @理鱼

12. 队列那个归根到底属于限流的范畴. 漏桶式，令牌桶. 根据业务来选择策略 - flea

13. 要不不从技术层面来解决。 让放票后，30分钟的人都进入预定池，然后给这个池的人 做随机分配。 延长分配票的时间，缓解系统短时间的运算压力. 目的就是避开秒杀的情况 - @理鱼

14. 把整化零按比例分配，定点冻结清算整理第二天再分配，要是时时感觉光数据同步都是大事。 - 小刺猬

15. 12306采取了分时段放票，压力就降下来了. 其实就是动态库存加秒杀 - 夜丶有雪

【分享链接】

1. http://mp.weixin.qq.com/s?__biz=MjM5MzMyNzg0MA==&mid=201175266&idx=6&sn=09556fd9c2a67af3454de41f6c8c10ad 编程王道 唯“慢”不破 - 黑夜路人

2. http://my.oschina.net/goal/blog/195749 PHP: 深入pack/unpack（陈一回） - XiangZ

3. http://www.csdn.net/article/2013-06-13/2815744-RESTful-API RESTful API 设计最佳实践 - 新坤

4. http://m.csdn.net/article/2014-12-06/2822992 京东集团副总裁李大学：像CEO一样思考 - 黑夜路人

5. http://mp.weixin.qq.com/s?__biz=MzAxNzEyODA2NQ==&mid=201340687&idx=1&sn=5663d7402f9cf68a0a64d7c011a604c9 2014互联网职场薪酬报告 - 黑夜路人

【12-10】团队技术负责人如何提高自己，以及带领团队发展？ - Meow

1. 作为leader我感觉就自身而言！目光长远！心胸宽广！适当放权！提高团队凝聚力！ - Hello world

2. 自身技术过硬 - Meow

3. 心胸要宽广是必须的 - yongsean

4. 对, 要承认某些东西, 你的下属比你强... 时常接受被下属打脸... - John__

5. 管理方法，工作计划，排期，工作流程的建立与优化，技术负责人放开技术 - 徐典阳

6. 期望是挺好的！但事实偶尔却事与愿违！不过作为程序员还是要保持心态平和！积极上进！ - Hello world

7. 还要学会背黑锅 - Hello world

8. 技术不放权，很难发展 - 凹凸曼

9. 其实技术管理人员最明显的一个变化就是平时工作时间接触代码的机会变少了，而技术方面又不能太烂，否则会被默默鄙视，鉴于这种情况只能自己业余恶补，但补的不是细节性的技术，而是方向性的技术！ - 马犇

10. 技术负责人技术功底要过硬，但是具体的编码能力不如底下人，这是可以的，底子不过硬hold不住团队，不能把控团队发展方向. 技术负责人对业务逻辑要比任何人都要精，否则也会失去对需求的整体把控，在技术选型上也会出问题，一旦业务跑起来就发现欠债太多了 - 我不叫大脸猫

11. 技术负责人把握技术大方向 譬如适时引入新技术 但在下属在技术运用上太过激时 也要能及时发现并纠正 - 粉粉的奶牛

12. 放权，把握好大方向，相信手下的人能力，相互协作 - 墨文

13. 自我修养，自我学习，责任，信任，分享 - Hank

14. 问: 有团队对工作进行量化的吗? 听说阿里那边有,效果很好. 比如修一个难度适中的bug+10分, 开发一个新模块+20分, 分数作为考核的一个依据. - twin

回: 我们有在使用，量化评估没那么细. 大致是每个人都有自己的职级，一般情况下职级越高做的任务难度越大，所以我们直接按同职级的任务量作对比，另外bug分成两类，历史原因的bug称为故障是计算工作量，关联任务单的bug不计算工作量且要计算bug率，超出平均值是要扣分的 - 水浸街

回: 我们之前公司是自己开发的一套量化系统,大致以产品项目功能点,虚拟团队和时间为维度来统计的. 产品的大小跟bug数量成正比评比,一般项目越大,bug数可能越多,然后最后按比例对比的. - 亚飞

回: 评估应该是一个开发组的人一起评，然后取个均值. 我们组分配需求的时候就是这样评估每个需求工作量的 - 李文凯

【分享链接】

1. 宣传下我写的新php扩展ptask，是一个php的协程实现。https://github.com/liexusong/ptask - 凹凸曼

2. redis-search 是一款基于 Redis 的高效搜索组件 https://github.com/huacnlee/redis-search - twin

3. 未来CTO、CIO职责趋势是产品经理化 http://www.csdn.net/article/2014-12-05/2822973 - 黑夜路人

4. 【最具价值CTO评选秀】MediaV CTO胡宁：技术女神的自我奋斗 http://www.csdn.net/article/2014-11-25/2822795-struggle-of-female-techlead - 黑夜路人

5. 弹性工作制的利弊有哪些 http://www.zhihu.com/question/26642988 - twin

6.  关于语言的选择-选易用的 http://www.laruence.com/2012/08/06/2681.html - 新坤

【12-12】常用的命令行工具分享,如fabric,composer,npm等等 - 陈一回,twin

1. fabric是python写的部署工具. 可以批量ssh上去机器，并执行命令 - John__

2. npm是node 的包管理工具。国内速度太慢了，可选用淘宝的镜像 - John__

3. 我们前端的命令行工具,主要用到bower,grunt,glup这几个

bower用来下载管理开源类库,类似composer
grunt用来调用bower这个任务
glup用来压缩合并js,css,监听文件更改等 - twin

4. 有用过几个php的工具
phploc 是一个快速测量项目大小和分析结构的工具
PHP_Depend是对一段给定的源代码进行静态代码分析的“小程序”，用来度量php项目代码质量的工具
基于pdepend的结果进行分析
PHP_CodeSniffer  php的语法风格检查工具
phpcpd重复代码段检查
PhpDocumentor 这都知道啦
codebrowser 源代码浏览工具  还有就是phpunit

稍微geek团队 组合下很容易弄个自动的代码质量自动追踪监控的方法 - 黄继德

5. 问: 分析之后,可以合并到svn,git,还是得手动复制过去呢? - twin

回: 用jenkins可以直接整合在里头. 分析直接结果html可以 直接看，  自己关注几个指标就可以搞每次迭代版本自动分析 - 黄继德

6. 发布用jenkins的push over ssh插件,没法并发,多台机器就慢了,准备下一步fabric写发布脚本,jenkins调用发布 - twin

7. 目前我用 ansible 做服务器环境部署。 目前我们规模小没弄运维平台， ansible 或者直接ssh操作svn up做代码部署 - @理鱼

8. 哈哈 我们也用jenkins  发布 跨idc确实慢的无法接受 - 黄继德

9. ncdu pydf dtrx 这几个是我常用的小工具 - 姚文强

10. Jenkins 机器多了，不稳定， 经常会造成同步未完成，又正好调度到该服务器，导致服务异常 - Meow

回: 这种 可以 push over ssh到 .xxx.com/2014xxxxxxx  然后执行exec 切换 软连接 - 黄继德

11. http://www.sitepoint.com/series/php-quality-assurance-with-jenkins/ 这个系列的文章不错 - 姚文强

12. grunt的任务是一个大json,很多项配置,所以看起来复杂. gulp的任务是函数,可以自己写逻辑,会直观些 - twin

13. 问:那gulp跟grunt是什么关系？ - 陈一回

回: 都是node的任务库,很多功能,插件重叠, gulp是后起之秀 - twin

14. 问: 求推荐测试并发的工具 - 胡志广

回: 还是ab, http load 之类的吧 - 黑夜路人

回: jmeter也行 - 飛鱼

15. 静态服务器npm install -g anywhere 和php -s localhost:8888 - 梦想旅程

【分享链接】

1. Nginx 获2000万美元B1轮融资，将用于推动国际扩张 http://3g.163.com/ntes/special/0034073A/wechat_article.html?docid=AD6DHTCN00964KKV&from=timeline&isappinstalled=0 - 黑夜路人

2. twitter系统架构分析 http://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&mid=201845390&idx=1&sn=79723619a5af4fdd8911d504c92cf144 - 黑夜路人

3. 浅析 Linux 初始化 init 系统: sysvinit http://mp.weixin.qq.com/s?__biz=MjM5NjQ4MjYwMQ==&mid=201606775&idx=1&sn=4f9cf4a1fc6a45ba2c36d4010d4e1a95 - 黑夜路人

4. 微博消息队列架构分析 http://mp.weixin.qq.com/s?__biz=MzA5MTE0MDUxMA==&mid=201835424&idx=1&sn=788e6aaa7a4037de27e49a5b4112f9e3 - 念念恩他爹

【12-16】在访问量提升后,已有程序如何优化,提高负载? - 蜗牛

【背景】
我们框架使用的是thinkphp.
服务器的配置是4核，8g内存10m宽带.
之前访问量这样都比较小。我们也就没有怎么去考虑服务器这块。
我现在一直在公司让吧负载这块做上。但一直进展不太顺利。 数据库现在是分离了，还有该使用redis的地方使用redis，服务器该陪分布式处理的就配置。我们明天上午要开会，希望你给我一些想法或者一些建议，，明天好确定具体的可行方案

1. 提高负载可以采用ip直连 - kacy陈臣

2. 我们之前也是四核8G. CPU吃的太严重. 建议升级到8核配8G - Jason Bourne

3. 目前的情景是 服务器端是nginx，cpu平均值在90%以上，数据库目前放在阿里云RDS上（通过检测，cpu也在95%左右），图片存储在七牛云存储。 - 蜗牛

4. 找台nginx做负载 - Jason Bourne

5. 先说瓶颈在哪里. 先了解问题出在哪儿在出解决方案 - 黑夜路人

6. 我觉得先找到瓶颈才是真的。 静态分离了没，带宽10m 图多的显然不够。 哪怕是静态完全玻璃出去。10m也不够的。 带宽是否是瓶颈。 检查跑哈php—fpm 配置是否得当。 检查cpu负载。 - @理鱼

7. 其一，访问量提高后，服务器各方面资源使用率较严重，其二，有人找刷票公司进行刷票，虽然数据正常，但大量的量，时常照成服务器返回502错误。 - 蜗牛

8. 哪怕该分离的都分离  也得检查页面响应时间。  总之先找到瓶颈. php慢日志是否打开。找瓶颈  瓶颈会引起各种雪蹦 - @理鱼

9. 看一下交换区是否用的太频繁，增加内存。看io - 飛魚

10. 常规检查，phpfpm里的max children数是否过小，我之前也是用的阿里云数据库，阿里云把waittimeout设的太大，调到120，图片，js，css要用cdn缓存，并且将其从程序中剥离，查查mysql慢查询，负载均衡做的合理否 - 酸酸哥

11. sql慢查询  php慢执行 等非常多的东西都会引起整个系统雪蹦的  你的定位.看到你微信说，mysql qps 才200都不是事 很小，是不是有慢查询 - @理鱼

12. 能异步就尽量异步 - 酸酸哥

13. http并发多少. 带宽是否一直满载. 你这个是不是本身就需要加机器了，看看 是不是达到机器的处理极限了. 核心思想找瓶颈 - @理鱼

14. 一般找瓶颈各种看日志，看系统情况. nginx 的日志查看错误日志，一般502都会显示upstream timeout，一般是php慢。然后沿着这个路径找下去。看下php. 一般php查看error日志和phpfpm slow log. php错误日志可以看到比如连接mc,redis,mysql等失败或者超时信息，哪个超时说明哪个是瓶颈。slow log可以查看那些执行慢的。 - 黑夜路人

15. 然后顺便看一下webserver 的负载情况，推荐使用vmstat命令。主要查看 r直和b值，还有id和wa值. r值高，说明你进程间切换很多，说明请求量比较大。b值高，说明你磁盘读写频繁，查看那些磁盘操作多。猜测你是r值高。最好查到高峰期的数据。那用sar命令查看过去12小时的情况. 没有监控系统情况下，多使用linux自带工具.  - 黑夜路人

16. 另外，建议没事在php里多打印日志，记录访问时间，呵呵，追查问题简单 - 黑夜路人

17. 如果是我，不熟悉这个系统的话，首先是从Linux查看资源占用入手，CPU、内存、磁盘IO、网络这几方面的情况 - 水浸街

18. 两种，slow sql，slow service，一般会在这两个纬度切面打印slow日志，以服务综合情况定义一个最大可接受时间，超过这个时间打日志到slow log里，便于分析。 - 于洋

19. 我觉得是这样的，一个系统里的所有服务器，出现瓶颈的主机CPU、内存、磁盘IO、网络这几项指标总有异常的，比如应用服务器的各项指标都不高，而数据库服务器的资源占用高，这个就要考虑优化slow sql、加缓存服务器. 如果没有任何主机出现指标异常，那么就是代码设计有问题，比如使用锁、sleep之类太过了- 水浸街

20. 看到前面所提的访问突然加大，我理解是qps增大，那么是否可以这样解决，在一个整体业务中，可能只有那么几个功能点会有瓶颈，这个时候可以将频繁访问的服务拆分单独部署rpc交互，当然这还要看具体业务。- 于洋

21. php最容易出问题的是请求远程资源超时没处理好，重点是file curl那些函数 - 徐刚

22. 一定要设置好timeout. timeout一秒的 就不要了，再打个日志方便查看. 特别是用 file_get_contents 的不设置 timeout 就是自作孽， - @理鱼

23. 要看定义，如果刷票在业务中被定义为作弊，那么就要控制这种用户行为，通常的控制手段和反爬差不多，从次数和频率上做流控，纬度可以从ip，用户相关信息上，如果严厉也可以直接封一阶段。 - 于洋

24. 业务是微信相关的，突发业务是投票相关的一些推广模块。 - 蜗牛

25. 突发性的要提高缓存命中率和sql的执行速度. 可以做缓存预热. 在投票之前，手机预热一下相关的缓存 - 张建

26. 问： 突发的话 什么时候做预热.. - tree

回： 发起一个投票之前 - 张建

27. 我们的产品属于平台类型的，投票这些都是由我们的客户发布。 - 蜗牛

28. 就是发布的时候不是所有用户马上可以看到，要经过预热后才能看到 - 张建

29. 你们多少流量？感觉投票业务全放到redis里面没啥问题吧. 那就先把数据放到redis 里面 然后批量往数据库里面刷. - tree

30. 突发的时候应该是有很多更新吧. 而且是更新一条记录. 然后数据库不能正常更新，导致web阻塞. 感觉上如果更新都在redis里处理，应该会好很多，还有一种方案就是更新用异步队列. 应该是死锁一条记录了. 控制一下更新，用redis或队列. 做好监控，在nginx的log里把时间打印出来，看看哪些接口慢，多调优一下 - 张建

31. 如果有些并发较大，但是逻辑简单的，可以考虑用nginx+lua+redis实现，提升性能，降低负载 - 应小俊

32. 可是你代码逻辑不可能用lua 来实现吧，lua 现在好的框架也比较少。10M带宽，你算下每个网页多大，看一下大概理论值有多少qps。看一下是不是带宽，还是后端。 - 一席

【分享链接】

1. 【技术分享】深入浅出DDoS攻击防御 http://mp.weixin.qq.com/s?__biz=MjM5NDMwNjMzNA==&mid=201673251&idx=3&sn=9863e492bf153b5adf3c368750a2db7b - @理鱼

2. 谈谈Docker的商业模式 http://mp.weixin.qq.com/s?__biz=MjM5ODM3MzkyNQ==&mid=206701456&idx=1&sn=749edaef83731fea88054ce055b90627 - 黑夜路人

3. 大数据会与深度学习划等号么？——2014中国大数据技术与学术大会专访 http://mp.weixin.qq.com/s?__biz=MzA4MjE5NjAzMg==&mid=202211667&idx=1&sn=c8d8e9e2b9c16d8d17cfaecf765f1a4f - 黑夜路人

4. 【问底】徐汉彬：Web系统大规模并发——电商秒杀与抢购 http://m.yuedu.163.com/reader/news/content.do?content_uuid=fc9ff3bd73e84d5c99ea9793be6461d1_1&source_uuid=426f1ed9-b19b-44f5-bcad-9f58930fc65e_1 - 李三

5. 2013年中国数据库大会PPT http://blog.nosqlfan.com/html/4209.html - adam

【12-18】讨论下HTTP Method(如GET,POST,PUT,DELETE)的使用经验和应用场景等 - 青衫隐_刘

1. 在REST中都有特定的含义, 我记得非REST中,PUT是用来向服务器推文件的 - twin

2. put 推新资源 delete删除资源 - @理鱼

3. Restful API中定义资源动作，部分框架中也是个路由入口 - 刘卫涛

4. 问: 推资源，删除资源会有哪些业务场景用到呢？ - 青衫隐_刘

回: 比如用户的收货地址是一种资源,创建一个地址是POST,更新地址,就是PUT,删除收货地址就是DELETE - twin

5. head方法，用于验证url的连通性，如果返回可以访问，则表示这个链接可用，如果返回错误，则需要用get方法再试 - 风之缘

6. 除了GET, POST, PUT, DELETE, 在restful约定里面还有patch. PATCH跟PUT在约定中都是更新资源的意思. 但是PUT是更新整个, PATCH是更新局部 - John__

7. 嗯,rails在这方面就做得很好 http://guides.rubyonrails.org/routing.html#crud-verbs-and-actions - twin

8. 问: 比如用户的收货地址是一种资源,创建一个地址是POST,更新地址,就是PUT,删除收货地址就是DELETE 这种完全可以用post解决吧？- 青衫隐_刘

回: 对,其实POST就够了. 所以我觉得写业务,get和post搭配就很好了. 当你需要提供api给外部时,才考虑rest - twin

9. 我先抛个砖，我理解的restful就是把uri理解成一个资源集散地 通过http的method表示对这个资源的 curd  欢迎大家拍砖 - 汉族教父

10. 为什么不紧紧用 get post 是应为只用这两个不能更清晰的来表现对资源的操作。 当然你非要只用这两个当然可以。只不过不清晰，也不符合rest api的标准. 我用过不少三方 api 国内按照这个标准的没几家。 - @理鱼

11. 因为http method是有限的, 用了rest意味着你的部分业务得合并在一起, 对开发人员要求更高了 - twin

12. 我理解的restful不是一个标准，设计的时候不必完完全全按照它提供的方式去做，它只是提供了一种设计规范或者是核心思想，根据这个思想设计api，对调用者有更高的又好度，更清晰。设计时根据具体情景可以灵活变通 - 涵戈

13. 用有限的http method去取代无限的action, 这是一宗罪. 不兼容已有路由系统,又是一宗罪
例如games/1/edit, games/1/ranking. edit是一个action,而ranking是resource,如果不是定两条路由规则,是匹配不出来的. - twin

14. 目前用rest,往往意味着开发人员第一步工作是想url, 定路由, 而不是直接动手工作 - twin

15. post delete put get，就好比增删改查 - 茂升

16. 就好比是一种设计模式. 就像现在web架构 大部分都是mvc,但也有ddd - flea

17. 反过来,REST好处也很多,强调了以resource为中心. 例如控制器经常会加入一些无关的action,就是因为开发人员没有以resource为中心 - twin

18. http method 的好处在于, 可以映射为读写删三种权限, 而get,post只是两种(结合destroy action可以加上删,但是没有http method直观) - twin

19. 现在移动互联网很火， 移动端平台又会越来越多， 对服务端来说统一api接口给不同平台调用， 这需要使用restful的架构思想来做 - Meow

20. REST是趋势,但已有系统大多是controller/action形式,我们也是,所以我们准备加上REST的支持,又保留已有系统的优势. 分享方案雏形给大家

a. 控制器和rails等一样,保留controller/action的形式, create对应post,destroy对应delete等等.
不使用resource::method形式,(如posts::get, post::delete),两个方面原因,一个是改造成本,另一个是resource::method扩展性差

b. request method判断逻辑改造,原来可能只判断request method是否为post,现在要细分为put,patch,delete.
这一步也可以跳过,以后再做.因为只有新的REST调用才关注method

c. 路由器改造,也是最重要的一部分.
已有框架象rails, laravel都是写一个模块在路由器里定个resource或是写个route规则, 模块中的资源嵌套又得定一个resource.
这种方法不够敏捷,特别是当你有几十个,上百个资源.
因此,我们希望用一条正则,或是一个简单处理类解决所有REST路由问题.

传统的路由框架,一般是通过正则匹配出controller和action的.对于REST URL,如photos/1/comments和photos/1/edit.
通过正则匹配,要么认为comments和edit都是controller,要么认为comments和edit都是action,而实际comments是controller, edit是action.

因此,传统路由无法用一条正则解决所有REST url,我们需要写个路由处理类.
核心逻辑是,给定一个URL如 photos/1/comments,
根据数字和斜杠解析为 photos::comments?id=1 (controller::action?querystring)和comments::index?photoId=1两种情况.

d. controller分发服务改造. 上面提到路由解析出来是两个controller和action.
传统mvc框架应该也是只支持一个controller::action的,所以要稍作改造,顺序判断哪个存在就执行哪个.

总结一下,保持控制器不变; 改造route解析出多组controller::action; controller分发服务支持多组controller::action
这样子就可以既保留原有业务,又享受REST的优雅. - twin

21. rest不只是一种协议 么. 这个与mvc不冲突啊 - tywei

回: rest不是协议，只是一种架构 - 光阴的故事

22. twin是主要把rest的http方法的约定去掉，保留url对不对 - 轩脉刃

回: 方法约束还是要的,有了才是rest,而且刚好可以拿来做权限控制. 但是原有系统改造这一步可以晚点做, 因为不影响原来的逻辑 - twin

23. 原来laravel的路由是基于symfony的路由..自己实现了很多对开发人员友好的方法,象Route::xx - twin

24. Laravel的路由还是蛮不错的，可根据资源例如user，直接定义基于user的RESTfull资源，Route::resource("user"，"UserController") - 青衫隐_刘

【分享链接】

1. 之前看谢大分享了这本电子书《Web API Design》，挺不错的，截图也来自这书
原地址：http://apigee.com/about/resources/ebooks/web-api-design
谢大搬到国内的地址：http://vdisk.weibo.com/lc/r07h62jt3F4PDsDPH  密码：HG7K - XiangZ

【12-22】在Linux下的php开发经验,工具,插件分享 - zhangsheng

1. 一般两层意思，一层是会搭建lnmp环境和基本linux命令和基本linux操作。另外一层意思是说能够使用vim，日志查看等工具来开发调试php代码 - 黑夜路人

2. linux下 可以用 composer 安装一个 boris php 的 repl - 姚文强 注：https://github.com/d11wtq/boris

3. 把本地盘挂载到开发机linux上，在windows开发，配下host就行了. 关机时没有卸载，下次开机时自动就挂上了。ip变了就重新挂 - 联合国秘书长

4. 切换 host有蛋疼的缓存问题，必须的重启浏览器，或者等一会。 所以我们才用的是切换代理服务器的方式，代理服务器用的内部dns来控制域名的解析。 - @理鱼

5. hosts切换插件我推荐一款开源的给大家。 switchhosts - @理鱼

6. 以前用hostadmin切host,现在是每个环境用一套域名, 例如开发环境都加上 dev.前缀, beta加上 beta. 前缀 - twin

7. chrome://net-internals/#dns 清dns缓存 chrome://chrome-urls/ 这个里面有所有的chrome功能 - 亢

【分享链接】

1. PostgreSQL 9.4 发布，提升灵活性、伸缩性和整体性能【体积缩小 50%，速度提升 3 倍】 http://mp.weixin.qq.com/s?__biz=MjM5NzM0MjcyMQ==&mid=201715569&idx=2&sn=604bd94b1fc9001e5fc2dab992a42ab1 - 黑夜路人

2. TMPHP http://baike.m.sogou.com/baike/fullLemma.jsp?lid=73600201&g_ut=3 - 黑夜路人

3. 移动app的UI https://github.com/frozenui/frozenui - smarteng

4. swf转html5 https://github.com/mozilla/shumway - smarteng

5. 谨以此献给Go 语言5周年 http://www.locuser.cn/case/qiniu3 - 黑夜路人

6. 国内第一个开源卫星项目正式启动 http://mp.weixin.qq.com/s?__biz=MjM5NTg1MzcyMQ==&mid=202370255&idx=2&sn=765664a1ffa58eafa563a00680fe5bbc - 黑夜路人

7. 配置豪华的Windows开发环境 http://mp.weixin.qq.com/s?__biz=MjM5NzA1MTcyMA==&mid=203051599&idx=2&sn=37486d3593a938fcc1323478d14d07ac - @理鱼

8. 门户级UGC系统的技术进化路线（新浪新闻评论系统的架构演进和经验总结）无码版 http://card.weibo.com/article/h5/s#cid=1001603789147444803230 - Orthogonal

【12-24】分享下在各自应用场景下的服务解耦经验和系统重构规划 - 刘卫涛

1. 我理解的解耦是分层次的. 在业务压力比较小的情况下，一般代码级别解耦就行了，比如说MVC就可以理解为一种解耦。在业务压力大，或者业务系统复杂的情况下，适当可以考虑模块或者服务的的解耦。比如说，各种不同模块中间，通过rest或者xmlrpc等方式进行通信，每个模块或者服务完成一个功能，就是解耦。 - 黑夜路人

2. 一般业务系统里，肯定都是分为用户系统，主业务系统，其他辅助业务系统，这些就可以进行解耦。比如用户系统是个独立的系统，然后提供http或者rest接口给其他服务使用，这本身就进行了解耦。 - 黑夜路人

3. 我感觉着，先要有一个良好的代码结构，任何功能的调用都需要有一个统一的API(函数)来服务. 在这个基础上，可以把相对独立的按照黑哥的方案搞一下，就相当不错了 - 张建

4. 我们这边主要的业务类似微店，近期在扩容重构，已经按应用的资源密集类型拆分了服务，针对业务就解耦，短信、消息通知、队列及主要事务等分解成模块  - 刘卫涛

5. 功能模块拆分，分配到多个子域名下，api通信，数据库的拆分。系统重构既要维护原系统可用，又要保证重构时间点，两版功能同步。一般先做模块拆分，然后逐步完成重构，两版并行。 - Star

6. 系统的解耦依赖业务的抽象化程度，首先要理清各种业务流程，流程内有多个环节，每个环节都是独立的抽象化的box，数据存储按域划分，每个环节内的代码只能访问公共数据域和本数据域，不能跨域访问，流程的执行分为同步流程和异步流程两类，同步流程可保证高一致性，一般是写代码实现，异步流程可提高客户体验，牺牲部分一致性，一般使用工作流实现。经过这样的整理后，整个系统的耦合度是比较低的，依照需要可以实现分布式部署。 - 水浸街

7. 个人我觉得大型电商系统就是高度解耦的系统，后端有订单、支付、仓储、物流、crm等子系统，子系统间的依赖尽可能小，比如生成订单之后给仓储发出库单，高耦合是等仓储检查通过确认可出库才下单成功，低耦合的做法就是生成订单后通知仓储，至于有什么问题由仓储解决，比如卖超了那么仓储重新进货、从其它仓库调货，或者和客户联系退单等。 - 水浸街

8. @水浸街  的很赞。我来补充个小东西。大家注意看 各大电商网站。 账号 用户中心 订单 商品 等等 都是不同的子域名。 这些是解耦的我们可以看到的最直观体现。 - @理鱼

【分享链接】

1. 异常在 PHP 5.3 中的最佳实践【深入了解一下 PHP 吧～】 http://mp.weixin.qq.com/s?__biz=MjM5NzM0MjcyMQ==&mid=201795161&idx=2&sn=ac1b52aa9fd5f11a79eebcfb7437872c - 黑夜路人

2. PHPTrace http://mp.weixin.qq.com/s?__biz=MjM5NzUwNDA5MA==&mid=201866133&idx=1&sn=6c18e1dec19e3768e70b91da1d6529c8 - 念念念恩他爹

【12-29】讨论下加密和网站安全，以及如何防止被拖库 - 黑夜路人

1. 最少三层防护吧：
a. 如何保证应用的安全
b. 如何防止应用被攻破后不被拖库
c. 如何防止拖库后密码不被直接破译 - 黑夜路人

2. 先说最后一层，一般比较搓的就直接存储明文用户名和密码到数据库里，黑客拿到直接爽歪歪了。
稍微好点的会经过类似于md5或者两层md5的方式存储密码，稍微保密点。但是现在是云计算时代黑客一般会有彩虹表，在彩虹表里一查，啥都出来了。另外一个就是如果没有彩虹表，那就买一堆云计算服务器，直接用分布式运算直接计算。
再好一点的防护是，针对存储进入数据库的密码除了hash加密，还加盐（slat），简单说就是自己加入一些特殊字符串或者token在加密前，类似于：md5（md5（$passwd . 'token'）） 的方式，这样一般彩虹表也无法查询了。 - 黑夜路人

3. md5（md5（$passwd . 'token'）） 这种方式交加盐？ 我比较倾向这种加密. 密码的话. 这个token值还是随机 - 蜗牛

回: 好的方法你无法知道token是啥 - 黑夜路人

回: 这个不好，建议用PHP5.5里自带的password_hash() - 赵拂衣

回: 蜗牛这种方式，都有表可查的. 用越不常用的方式越好 - @理鱼

回: 恩，加密方式最好非常用的。 - 黑夜路人

4. https://github.com/ircmaxell/password_compat 非5.5也用这种标准库吧 - twin

5. laravel自带的user就是用password_hash - 轩脉刃

6. 那么黑客针对加盐了的密码。常规他们会利用类似于渗透里旁注的方式。
就是说，你不是加盐了么，但是我知道你用户名啊，那么，作为黑客，一般手里会握有很多被拖的库，比如各种游戏网站，音乐网站，各种小网站等等，里面也有用户名密码，而且要是刚好看到某个用户名也在他手里某个库里，刚好用户还喜欢不改密码，每个网站密码都一样，密码不就出来了嘛。
这个就叫做撞库，这种一般没有防护的好办法。 - 黑夜路人

7. md5(md5()) 象这种直接双层md5, 当表足够大, 外面那层就可以反查出来, 安全性又减弱了. - twin

8. @twin?  标准库是不是有彩虹表可查的问题。 越不标准越好。  彩虹表还的新做 - @理鱼

回: 象cmd5上面那些类型,不管多不标准,都是md5或sha1生成的. 他拖了你的库,可能也就知道了你的不标准算法,反过来计算就可以得到你的md5值. 所以与其自己在md5上做文章,不如用salt这类更安全的通用算法 - twin

9. 目前我找到的最好的方式就是 password_hash() ，之前用过 phpass 但有些小兼容问题. wordpress 用的是 phpass - 赵拂衣

10. 问: 用password_hash创建了密码，比如我用java接入这套用户系统，怎么验证啊 - 涵戈

回: 1.你可以考虑模拟一个，反正有源码；2. 实现一个service；- 赵拂衣

11. salt注意复杂性和随机性和单用户不一致性,破解难度已经增大很多倍了. - 亚飞

12. 加盐hash保存密码的正确方式 http://drops.wooyun.org/papers/1066 - secdragon

回: password_hash 就符合这种思路 - 赵拂衣

13. 看来用用户名当盐是个好办法。拖库一方面，代码别给看见了。 - 黑夜路人

回: 早几年前我还想着密码和用户部分信息关联，后来事实证明这个想法是完全错误的. 不安全呗 - 赵拂衣

回: 密码应该和用户之外的信息熵关联.越无规则越好, - 亚飞

14. password_hash函数 http://php.net/manual/zh/function.password-hash.php - 安正超

15. @赵拂衣? password_hash5.5才有 在php5.3下是否有php开源类实现 - @理鱼

回: https://github.com/Antnee/phpPasswordHashingLib - 安正超

回: https://github.com/ircmaxell/password_compat - 赵拂衣

回: https://github.com/twinh/wei/blob/master/lib/Password.php 需要精简版的可以参考这个, 根据password_compat简化的 - twin

16. 我现在的做法是md5加密后传到服务器，服务端有个salt  key.遍历md5值，根据oRD逐个插入salt  key字符,如不符合则放到最后,再md5 - 陈一回

17. md5保存的密码是不可逆的吧，做系统升级时就无法做加密方案修改了 - 水浸街

回: 是不可逆的但是cmd5整天在计算. 只要不是很变态的，基本都可以查出来，或者算出来 - 钱志强

18. 我用rsa私钥加密，加了token - 水浸街

19. 如果真的要修改加密方案,我们目前的做法是：
去旧密码表验证，如果成功，用新的加密方式写到新表，同时删除旧表记录
如果验证失败，再去新表验证. 密码就不应该存成可逆的吧 - 安正超

20. 系统安全这块之前搞过不少，不过多数都是在用户认证、敏感信息模糊化、url安全审计这些方面，像这个防脱库都是请第三方公司来操作的，反正是客户掏钱 - 水浸街

21. 如果有 mysql中间件 可以做脱裤语句过滤。 waf也可以阻断大文件的下载 - @理鱼

【分享链接】

1. 【原创】开源爬虫Scrapy的学习及应用 http://mp.weixin.qq.com/s?__biz=MjM5MDg2NjIyMA==&mid=203335218&idx=1&sn=a074e0664b7a7ab9d5e3525257da353e - 黑夜路人

2. gx_lua_waf是一个基于lua-nginx-module(openresty)的web应用防火墙 https://github.com/loveshell/ngx_lua_waf - 钱志强

3. 为什么一些古老的编程语言不会消亡？ http://mp.weixin.qq.com/s?__biz=MjM5NjQ4MjYwMQ==&mid=201946490&idx=1&sn=37bd8140d44ab916cea0a4a8d65b2721 - 黑夜路人

4. 互联网黑市分析：社工库的传说 http://mp.weixin.qq.com/s?__biz=MzA3NTcwOTIwNg==&mid=201530781&idx=1&sn=12ba7dc1147bc518dec17d0c7495cd76 - 黑夜路人

【12-31】分享下工作和学习的时间管理，以及辅助方法和工具

1. 我一直用doit.im - 轩脉刃

2. 试试. 番茄工作法 我实操不了。 平时也就是用任务列表了，做一个化掉一个 - @理鱼

3. 我一开始本地搭个todo程序,接着用笔记软件,然后用anydo,然后用谷歌日历, 现在回退到记事本了. - twin

4. @twin   工作电脑，我也退回到记事本了 - @理鱼