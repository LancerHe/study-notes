> 转载自：<http://mp.weixin.qq.com/s?__biz=MzA3MDA2MjE2OQ==&mid=209182409&idx=1&sn=8d219bab0f7e51530abbcb1464270575&scene=1#rd>

【今日话题】
多线程相关经验分享,如怎么学习多线程编程,分布式缓存和线程安全问题？ - Ragnarok, liyang, 程序员朋

1. 这个要从原理上理解吧 多线程 交互 资源申请 释放，有哪些维护信息，有什么浪费。线程间如何共享数据，通信等。 - 金灶沐

2. 多线程，我个人感觉比较核心的，就是怎么用好锁了，从底层来说，用读写锁还是互斥锁；然后，最好事先死锁检测然后释放的逻辑，基本上也就这样了，理解比较表面，至于什么情景开多少线程要具体问题具体分析了，多线程比较麻烦处理的就是临界数据里锁的应用吧.....
如果线上发生了死锁问题
经验的话
就是你要监控检测自己的服务，如果不服务了，发生死锁了，再重启它前把core文件导出来
kill -11 进程
就可以生成core文件了
有时候，三更半夜没法上去跟进的，导出来再看，目前觉得死锁问题，很难通过看代码排查.....只有卡死时候跟进，会容易很多
还有一个经验，就是申请锁和释放锁，都写map里，记录下，死锁了，查map就可以了....
自己也可以加工下，程序自行解锁[偷笑]，不过逻辑自己解决...
死锁问题，比较容易发生在多个锁嵌套用的时候，上锁顺序和解锁顺序不对
或者说你锁的粒度太大
多线程的坑以前踩得多了....
- 学在囧途

3. 尽量避免共享变量 - 鲁猛

4. 尽量避免多线程，尽量避免线程锁，如果都避免不了，尽量保证逻辑清晰，认真开发
我以前因为一个死锁折腾了一个星期
最后改成多进程模型
然后我就尽量避免多线程也一直没问题
我现在考虑多线程场景就是要共享fd的时候
我们去年做的一个项目用多线程也只是开一个线程监听inotify
避免锁
php不好做链接池也是因为fd共享
话说你们考虑过如何让多进程传递fd么（不是父传子） - 惠新宸

5. 还有我个人觉得今天多线程的话题太广了，多线程要在语言的框架内讨论，会有更加好的效果，个人观点。。。潜水了 - 学在囧途

6. 脱了操作系统讨论多线程都是白搭的
操作系统原理
否则只能了解表面的 - 凹凸曼

7. 问: 那你说说创建线程都做了什么 在系统底层 - 学在囧途

回: 复制寄存器还有运行环境
例如文件fd，内存映射 - 凹凸曼

8. 多线程很多内容的，比如你gdb调试多线程也是可以讲挺久的.... - 学在囧途

回: gdb那些已经不是多线程范畴了
最简单实现多线程就是保存和切换cpu寄存器
类似于协程 - 凹凸曼

9. 携程做的就是多线程的事
只不过是用户空间调度
多线程太危险
锁复杂
整不好就死锁，fd就满了
cpu调度还高
不挺的争抢
携程主动退让
共享模型。 - 金灶沐

回: 对，少了定时调度 - 凹凸曼

10. 说说我对多线程设计避免死锁的经验。按照白盒测试、黑盒测试理论，所有的计算机程序都可以看成一个盒子，多线程中的每一个线程其实也是一个盒子，与其它线程的交互就是数据，线程安全问题就是数据安全问题，保护数据安全的普遍做法是对数据进行加锁，加锁后又引入一个新的问题就是死锁，对付死锁最简单的办法是线程内同一时刻最多有一个锁。我设计的多线程程序线程内都没有显式加锁的，所有锁都是由数据对象内实现，比如输入数据
输出数据使用线程安全队列，也就是说push、pop时自动加锁
没输完就发出去了
目前来说我还没遇到过用这种方式无法实现的情形，谁有相应的案例欢迎发出来讨论一下 - 水浸街

【分享链接】

1. Go语言构建高并发分布式系统实践 http://mp.weixin.qq.com/s?__biz=MjM5NzAwNDI4Mg==&mid=209282398&idx=1&sn=9ffef32b3ab93d1e239c9dc753a3a9bb - 猿蜗

2. 5 分钟介绍帮 12306 解决数亿人订票问题的 Geode http://mp.weixin.qq.com/s?__biz=MzA5ODM5MDU3MA==&mid=209801806&idx=1&sn=35aa034ddfdbabcbeb51f365588b2041 - xiaolv

3. 写一个每秒接收 100 万数据包的程序究竟有多难？ http://blog.jobbole.com/87759/ - 黑夜路人

4. 【算法江湖】哈希之战【上】 http://mp.weixin.qq.com/s?__biz=MjM5ODIzNDQ3Mw==&mid=206981549&idx=1&sn=34e0fb7dd05b9b2db99ed49c1498aaee - XiangZ
