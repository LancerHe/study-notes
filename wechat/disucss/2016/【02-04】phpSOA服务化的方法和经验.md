> 转载自：<http://mp.weixin.qq.com/s?__biz=MzA3MDA2MjE2OQ==&mid=401892022&idx=1&sn=99c7f3557cb58b960e020ac39d602c0e&scene=23&srcid=0204BVUB7yInbN47j93SdU5Z#rd>

#### 今日话题

phpSOA服务化的方法和经验 - liyang

1. 我简单说两句我的困惑 我们目前是所有的针对客户端的接口 都有个类似于api的service进行 处理 在api server里面每个接口会调用不同的系统服务 比如用户service 订单 service 等等 但是我现在遇到一个问题就是 前台的api service 有可能需要调用多个service 这样会导致 处理比较慢 这个问题怎么破 有什么好的通用解决方案么？ - 蚂蚁

2. 有没有中间层，你发过去请求，然后中间层并发的去后面请求，这样累加的计时变成了单个最长。 - 小刺猬

3. 对 现在没有 不知道怎么做 或者从何下手
前几天看到一个帖子说 curl支持异步 还没来得及试试  - 蚂蚁

4. 我们最早是加集群，负载较高的接口分布到不同的集群，问题是更新代码很麻烦，因为节点太多。
后来把所有应用注册到zookeeper，然后统一分配接口资源。
你可以参考一下dubbo的实现逻辑，感觉很舒服，扩展和容灾都很方便。 - 阎铭

5. dubbo 有语言要求么？
恩 好的 去研究研究 刚才看到 有人推荐鸟哥的 yar - 蚂蚁

6. 搞一般的 php 项目，引入 dubbo 感觉太重了
一般的多接口请求，如果是 http 的，你可以用guzzle并行请求
其它可以 yar，或者 gearman，都可以并行 rpc - Eric 爸爸

7. guzzle还提供promise 挺好的
guzzle就是个 库  http客户端 - 先为乱步

8. dubbo是java写的，不太适合PHP - 阎铭

9. 恩，搞 lamp 架构，技术选择上要尽可能简单
我最喜欢的是 gearman，不过现在很多人都忘记它了 - Eric 爸爸

10. 蚂蚁碰到问题实际上 异步和解耦
很多种说法 job server microservices eventbus  或者pubsub之类的解耦方式才是正途 - 王春光

11. 其实没多复杂，能异步就异步，不能就用前面说的那些方法
做到刚刚好就行，别引入太复杂的技术 - Eric 爸爸

12. 问: 蚂蚁的问题是处理一个客户端请求时需要调用到其他多个service吗？  - 小火箭  
回: 现在整个系统的业务逻辑已经比较复杂 每个业务都在直接 操作数据库，现在想做的第一步就是先把 所有的业务 服务做起来 调用每个业务对应的服务来做数据库层面的修改
然后 对外的接口层面 来分别调用不用的业务服务
对 目前这个阶段 拆分完了 发现这个问题 - 蚂蚁

13. 为了soa而soa 好多时候都把自己坑了 - 王春光

14. 如果你想把业务用 microservices 改造，一定要慎重，取决于你的 team 技术实力是否能 hold 住，否则保守一点比较好
如果有依赖关系，不能简单并行，那么 gearman 之类的相对更合适一些 - Eric 爸爸

15. 有依赖顺序的话，要缩短处理每个客户端请求的处理时间，只能缩短各个service的调用时间了= = - 小火箭

16. 蚂蚁那种改造 不光牵扯技术实现层面 更多的得搞清业务模型  减少依赖关系 产品和架构方面的多 - 王春光

17. @王春光 microservices 这块也是最近听的比较多的 能举个简单的 解耦例子么？ 比如 下单的过程 我们目前是 用户提交 下单请求 先检查用户有无购买资格 检查购买的商品是不是互斥  然后检查用户的券 检查用户的余额 之后就创建支付  - 蚂蚁  
回: 基本上就是炒旧饭 换个新鲜点的名字
比如 下单的过程 我们目前是 用户提交 下单请求 先检查用户有无购买资格 检查购买的商品是不是互斥  然后检查用户的券 检查用户的余额 之后就创建支付   你这不够复杂啊 - 王春光

18. soa对团队要求挺高的
感觉很容易写出来循环调用soa的玩意。。。 - 轩脉刃  
回: 什么意思？ 类似 ORM 里 N +1 的 SQL 调用问题？ - Eric 爸爸

19. 不过soa确实有好处，就是解耦啊
分模块 专门的人做专门的模块  你不 soa 也可以分模块啊
要不然一坨，项目大了也是问题 文件夹分么 - 轩脉刃

20. 我们这业务还算比较简单 其实就是分模块 各自维护自己模块的代码 供直接对外的api接口来调用  - 蚂蚁

21. 异步和解藕会使得系统复杂度大大增加，之前我们的做法是，首先有一轮业务检查，都检查通过了再执行业务受理，然后还是会有受理失败的，各系统要支持撤单
蚂蚁这个似乎只有一个写库的地方，应该还是比较简单的 - 水浸街

22. 大家一个项目文件夹分开模块也是可以做到的，但是我觉得这个是一种心理问题，就好比你把蛋糕放到coder旁边，说大家一起规定不要偷吃，和你告诉人家，蛋糕在隔壁老王家，你要的话只有找他们要，这个最后结果是不一样的。。。- 轩脉刃

23. 那就是分层就可以了，前端调用业务受理层，业务受理层再组织业务逻辑，按需要调用各系统的接口 - 水浸街

24. 如果项目足够大了，分成多个肯定是必然的，不过多数项目达不到这种体积，分有分的好处，不过也有坏处，好比两个数据库表，分开了，后来你才发现需要 join - Eric 爸爸

25. 划分子系统是个技术活，要保证各子系统间不能互相调用 否则系统极难维护 - 水浸街

26. 允许子系统互相调用有什么太大的问题么？ 会有这个需求的 - 轩脉刃  
回: 子系统多了，一个是调用慢之类的，另一个是部署运维复杂，技术门槛高 - Eric 爸爸

27. 问: 只要每个子系统的职责划分清楚，子系统互相调用没什么问题吧 - 轩脉刃  
回: 单纯这句话肯定是正确的 - Eric 爸爸  
回: 子系统多部署真是头疼的问题，有上线顺序，出问题回滚还需要注意回滚顺序  
想想还是老王说的，大部分系统还是不要引入比较好 - 轩脉刃  
回: 允许互相调用，随着系统的发展复杂度越来越高，每一个子系统都不敢轻易重构，因为很难有人清楚整个系统的全部逻辑的 - 水浸街

28. 分久必合，合久必分
合本身都正常，主要看哪个时机
如果一个小系统，我们硬要分 soa，微服务，多半没意义，但大小的评价很难界定 - Eric 爸爸

29. 把业务逻辑收敛在业务受理层，这样解藕才够彻底 - 水浸街

30. 我觉得不管是 soa 还是 microservice 做的都是解耦的工作 - 蚂蚁

31. soa和microservice在我看来是一个玩意。。。 - 轩脉刃

32. soa 和 microservice 看待问题的粒度不一样，但其实就是个名词，如果不太严谨的说，n 年前流行的 php+gearmand，我觉得就是 microservice
只是起了一个富丽堂皇的名字，所以它流行起来了，但很久很久以前，其实它旧存在了
名字很重要，写代码最难的就是命名
今年流行微服务架构，去年流行的是单元化架构
就跟今年流行红色，去年流行紫色一样，没必要太关系这些，底层不变的东西更重要 - Eric 爸爸

33. 应该是不同的规范标准吧，实际就是从A发一段数据到B，B处理完把结果返回给A，定义一个标准的目的是让大家统一遵循，用同一种语言说话 - 水浸街

34. https://github.com/rryqszq4/JsonRPC 我们这边用jsonrpc - 这个人很开心

#### 分享链接

1. OpenSSL CVE-2016-0701私钥恢复攻击漏洞分析 http://blogs.360.cn/blog/openssl%E7%A7%81%E9%92%A5%E6%81%A2%E5%A4%8D%E6%94%BB%E5%87%BB%E6%BC%8F%E6%B4%9Ecve-2016-0701%E5%88%86%E6%9E%90/ - 黑夜路人
