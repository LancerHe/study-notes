> 转载自：<http://mp.weixin.qq.com/s?__biz=MzA3MDA2MjE2OQ==&mid=401839642&idx=1&sn=0355aaa80f2353221c9b28dfd782ecc8&scene=1&srcid=01272LSPLhv7eiheVlfelSmK&from=groupmessage&isappinstalled=0>

#### 今日话题

https遇到的坑 - 红桃♡

1. 扒一扒HTTPS网站的内幕 http://segmentfault.com/a/1190000003801450 - 学在囧途

2. 回到今天讨论的点吧，目前搞HTTPS遇到比较坑得2个点就是  
1、https页面下的资源均需要https，http会告警或不加载执行，如果页面里包含多个业务方的服务，业务推动比较累  
2、当把部分接口改为https，http里请求https会产生跨域问题，我们当时遇到的问题是酱紫的，接口执行逻辑依赖cookie，而cookie是设了httpOnly的，跨域的异步请求也并不携带cookie.... - 学在囧途

3. https下全请求https，http则请求http - 晴天

4. 跨域问题不能算https带来的，大型服务一般很多二级域名首先也要解决跨域呀 - 李鑫

5. 全站 https 就可以了吧？ 但是 cdn 如果不支持 https 就麻烦了 - 菜包子

6. 不少cdn已经支持https,如果不支持,换cdn就是了 - shawnvan

7. 问: 收费的ssl  证书 有推荐的吗 - 代号:红桃五  
回: 沃通的价格 starssl  199$  推荐  starssl - Jason Bourne  
回: 这只是公开价格，私下谈能便宜 - 李鑫  
回: globalsign - 随手写的

8.  @学在囧途 https包含http请求的那个我也遇到过，比如我的博客是https的，但是引用了多说，多说里面的头像是http的请求，我把多说的js下载下来，然后修改了头像的http请求，将请求指向本地，然后用本地https去读取图像，显示出来…虽然有点曲折，但是看到小绿🔒还是很开心 - 青衫隐_刘

9. 坑一、证书只支持二级域名，不支持三级域名 - 刘世林

10. letsencrypt 免费的，群里筒子说坑挺多。  
startssl 也有免费的，没用过，不知道有啥坑。 - 路超

11. 沃森。免费证书 用过 挺好用 - 苹果

12. HTTPS 部署简要指南 https://mp.weixin.qq.com/s?__biz=MzAwNjMxMTA5Mw==&mid=401808852&idx=1&sn=1ee26671c69ef1434147fb88ce10021b - 星海湾

13. 问: 免费证书，浏览器有报警吗 - 刘世林  
回: 没有 免费的时加密 强度不够高 - 苹果

14. 证书还是在墙外买的好，比在国内代理要好多了，之前想买一个通配符证书，国内贵死，后来去digi买，一半不到，不过其中双方沟通确实好玩 - chung

15. wosign不要用！我周边的朋友电脑都是不信任这个根证书的 - 沐旦

16. 我说一个坑：最近一个以接口对外开发的项目，出于安全考虑，在nginx上配置了https双向验证，用的自签名证书，在开发与联调环境测试都没问题。上线那天指导运维在生产环境配置成功，但访问死活不通。生产环境比较复杂，做这一件事情需要三个部门来协调来做，各说己见，到最后发现tm掉坑里面了。有人说f5需要配置证书，有的说现在环境没搞过双向认证，对双向认证产生怀疑。我也是醉了 - 罗金龙

17. CloudFlare免费https证书 + 免费CDN - Daniel

18. 目前我们用的starssl  有个坑就是线上要把根证书导入进去，其他用着还好 - hey

19. let's encrypt 在成长，很期待 - 张路超

20. 昨天刚搞了一下,在如果主机负载均衡后有点麻烦,也是用的acme-tiny,不过作了修改,在验证文件生成后要做好验证文件的分发，而且有些域名直接绑的阿里云CDN,目前证书更新只能手动搞 - tofuliang

21. https的页面不能包含http页面，就像我们这边因为有调用其他站点的文件，最后不能使用https,上了https之后腾讯的cdn暂时还不支持，最后又把cdn下了  
上https要考虑的还有针对多域名，多证书，IE8就不支持SNI 报证书错误，另外针对国情对IE6也需要排除，不做强制跳转 - 红桃♡

22. 我们也遇到了类似的情况，用了百度地图的API，上了HTTPS后，地图不能用了，查了一下文档，要付费才能使用百度地图的HTTPS API - 沐旦

23. 我来给大家分享一个https的坑吧。  
这几天网站上了https，用的let's encrypt 的证书，首先安装客户端的时候，总是爆出openssl错误，排查之后，发现版本不兼容，我的openssl是1.0.2d，centos7，安装的时候发现自动安装了openssl1.0.1e以及对应的openssl-devel。导致出错。  
我搜索了下，几乎搜不到相关资料，最后来是在官网看到了类似问题，不知道是不是官方的人员给的回复是保持自带版本1.0.1e，没办法，这个估计行不通了，因为我的openssl是源码包编译安装的，降级是不行了，另寻它法吧  
然后又看到了一个工具： acme-tiny 。这个工具比较轻量级，顺利的完成了证书的申请，所以，大家在申请任何证书机构的证书之前，先了解下环境软件版本的支持情况。  
因为，我是第一次搞https，所有木有经验，那本openssl版本问题估计也能解决，不过我不太会。没研究出来，哪位大神懂的话，可以指导下  
https弄好之后，又遇到一个坑，就是支付宝支付回调问题，我发现，支付的时候，微信支付可以正常回调，支付宝总是出错，开始一直以为我程序有问题，查呀查，查呀查，弄到凌晨2点，终于尼玛发现了，支付宝压根没回调过来，结果，今天上午，我联系了支付宝的官方技术人员，说明情况之后，他们说支付宝对这个证书（lets encrypt）暂时不支持，泪奔了，他说，他会反馈，证书支持更新后会发公告。所以我的选择，就是暂时不用支付宝了，等.......他支持  
所以，大家做https的时候要弄清楚你网站的业务相关对证书的支持情况 - 刺客

24. lets encript这么坑，我给以前公司弄的rapid ssl，很快啊，也没遇到问题  
rapid ssl直接官网申请  
也可以找代理  
代理贵200左右  
会比较快  
不然要等几天 - 杨春勇

#### 分享链接

1. 电商必读丨追求极致：从技术细节看美团架构 https://mp.weixin.qq.com/s?__biz=MjM5MDE0Mjc4MA==&mid=402465951&idx=1&sn=c76193b13b506d2c631bac8840a0f5b6 - 黑夜路人

2. 高德架构迁移阿里云的实践：从7个私有机房到公有云的历程 https://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&mid=403669579&idx=1&sn=360120446187ad7cfc3ac6a6068ef99a - 路超

3. 「PHP bindings for Go」，将 PHP 绑定到 Go 语言里，可以直接在 Go 语言里使用 “世界上最好的语言” https://github.com/deuill/go-php - 沈括号
