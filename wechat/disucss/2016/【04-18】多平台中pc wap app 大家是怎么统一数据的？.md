> 转载自：<https://mp.weixin.qq.com/s?__biz=MzA3MDA2MjE2OQ==&mid=502612984&idx=1&sn=8cd5a17b2ff6e574d7081020681d52c0&scene=1>

#### 今日话题

多平台中pc wap app 大家是怎么统一数据的？

1. 搭建服务中心，全部api调用吧 - Star

2. 我们现在就是这样干的   pc wap app都是调用API   - 严豪

3. 这样，数据层统一api,,然后加一个渲染层。 - tywei

4. 基础数据API，保证唯一，而且粒度最小，然后适合不同的平台获取数据，由他们来根据页面调用细粒度的API  
比如是：新闻列表页，PC端有关联新闻、分类介绍、我读过的，推荐新闻 ，但手机端可能只有一个新闻列表+推荐。  
当然这样不太好，但也是一个解决方法之一~ - 小小膘叔 ‍

5. 目前公司是写一套通用的API，PC、wap 和 app 都调用API，数据统一用API来处理~  - 大磊

6. 以前微博的pc是单独一套，app,h5,wap都是共用的，不过去年开始，逐渐拆开了 - tiyee

7. 之前我们也是合在一起   现在慢慢拆开了 -  xH 

8. 因为不是一个部门的业务？ - 昱北

9. 不是，合一起，弊大于利，自然就拆了，运营策略，更新频率不一致，迭代麻烦 - tiyee

10. 底层数据提供统一API，上层业务对API数据进行包装，不同业务需求在这个API包装中处理，不行？  - 昱北

11. 数据是一致的吧  api提供不同的 - Orc_LaoT

12. 数据是来源于更底层的平台，这个是一致的，但是接口这边包装的不一样，以前接口保证也是一套程序 - tiyee

13. 接口写一起 对某个端做特殊处理会很恶心 ，接口拆开  api层组装。  底层提供原始数据 - Orc_LaoT

14. 这算区分颗粒度？ - Lee.Li

15. 其实就是加一层……任何问题都可以通过加一层来解决…… - 吕霖

16. app有些功能跟pc不一样   另外写一个特殊的方法  很蛋疼 -  xH 

17. 分层处理，app和pc本身就是两种业务，我们的现在的做法是分数据层、服务层（缓存之类的） 不同的业务端调用服务层api 然后在各端做业务逻辑 - 朱政国

18. imo: 总得原则是有一个统一的数据中心，配合各相应业务库。同步方式:  
	1. 通过扫描发生变化的表记录
	2. 读取binlog事件 - jimmy

#### 话题外的精彩

1. 关于语言选择上鸟哥的总结：  
看一个语言, 一个系统, 一个项目, 好不好, 我们要不要用, 最最重要的是看:
	1. 背后的社区是否强大, 这个直接关系到你可利用的资源是否丰富, 出了问题是否很容得到解答
	2. 背后的组织是否可持续发展,  一般个人项目, 除非是小工具, 否则很容易蛇尾, 导致你后续只能被迫迁移  
如果一个问题, 能有多种解决方案, 那么一定选用大家都用的方案. - 惠新宸ᵀᴹ

2. 鸟哥说的很对，个人项目，特别是功能涵盖比较大的项目，非常非常容易后劲不足。 - 吴延毅

3. 我之前和我师兄聊, 他是一个在线教育的创业者，第一版的项目使用erlang写的, 后来俩个人不合, 这个CTO走了..于是, 这个项目他再也找不到人维护升级了!!!! - 惠新宸ᵀᴹ

4. 创业者 一定要用最简单的和市面上比较流行的语言 - You

5. 研发经理。后面来了个PM, 变像性的把他给弄走。然而，他走了，后面的人都玩不转。虽然是PHP（不过这与语言无关了）。。 - tywei

6. 我说下我司情况，之前都是PHP 后来来了个CTO 要换成PYTHON 然后做了半年 这人走了。
 然后python人又半年招不来 又改成PHP  结果现在公司客户端 PC 两套代码  俩团队维护 。 - 汉族教父

7. 方便招人，方便学习，用主流语言没错。但是，你找个c++写的好的人，比找一个golang写的顺溜的人要难。特别c++写后端server，坑太多了，golang写的顺溜很容易，语言本来简单，天生各种特点，搞起来简单。 - Black

8. @Black 是的啊，目前来看，go语言的搜索引擎就是bleve最靠谱，之前我也想自己搞一个go的searchengine，结合c/c++/go 来搞，但是感觉一个人搞不定就放弃了。目前主要关注bleve。 - 吴延毅

9. 王垠：系统设计中，很多人喜欢让代码灵活，“可配置”。后来发现，配置文件越来越复杂，里面逻辑越来越多。最后配置文件变成了一种代码，而配置文件语法，变成一种奇葩的程序语言。出现这个问题的原因，被我叫做【逻辑守恒定律】：逻辑不在代码里，就在配置文件里。代码里的逻辑少了，配置里的逻辑必然增加。 - 惠新宸ᵀᴹ

10. 配置真要做得好也是不错的，之前在mixi配置里制定decoration顺序，一个数据就自动组装好了 - 朝沐金风

11. 我的经验就是：为当年吹下的牛逼负责，然后就持之以恒了.开源不仅仅是开源代码，很多东西需要跟上 - Asta Xie

12. 个人还是不靠谱，有惰性，还是要依赖于组织，才能长久下去。  
个人 < 团队 < 组织 < 系统  
感觉成立个Golang基金会这个很靠谱啊  
今天了解了一下Rust语言，基本感觉是D语言的翻版。  
Rust语言都十年了，还没爆发，感觉没戏了。  
有个现象：一个语言在创立前三年没有大规模PR传播或者是项目应用，基本后期很难大成。 - Black

13. 问：插入一下，小文件分布式都用的啥，有推荐不 ? -  Star  
答：推荐 SeaweedFS或bfs  
    SeaweedFS：https://github.com/chrislusf/seaweedfs  
    B站bfs：https://github.com/Terry-Mao/bfs   
    听闻今日头条内部的部分小文件存储系统拿weedfs改的，用golang开发的  
    看各个公司的实际情况，用云服务各有利弊。  
    我算过一笔账，如果是10T以内文件，每个月100T以内的流量的企业，直接用七牛更划算。  - Black  

14. 我还是推荐用七牛的服务，自己构建小文件系统总是成本投入太大 - Asta Xie

15. 规模没到 还是用别人的合算 边际成本递减 - 志强@亦友

16. 公司对数据安全（隐私）有要求的话，云服务可靠吗 - Star

17. @志强@亦友 是啊~ 自己维护成本很高的，CDN、分布式存储、运维、机器 - Black

18. @Star 这个看各个公司的情况，应该是可靠吧，哈，文件切碎再各个服务器，应该算靠谱。- Black

19. 七牛的毛病在于部分CDN节点速度不是太稳定，可能是CDN受制于第三方，什么 ChinaCache 之类的，不过总体速度还算可以，就是这个价格和对应提供的服务来说，算不错。听闻七牛今年准备自建CDN平台。- Black

20. 之前不是个大网站的证书都是12306 就是CDN的锅 https://www.v2ex.com/t/74288 - 志强@亦友

21. cdn本来就是一个坑，小错小坑在所难免， 查找点也麻烦，经常叫客户手机ping一下。。 好折腾 - vk

22. 但至少不会那么无力  毕竟东西在自己手里 - 志强@亦友

23. 而且被攻击的时候，普通的cdn才是叫悲催呢 - vk

24. 东西在自己手里, 然后你看到了问题, 但是束手无策，你比如你要防ddos攻击, 你只能上巨带宽，但是, 你有那钱么?所以, 还是用巨云吧! - 惠新宸ᵀᴹ

25. CDN还是用阿里云把，毕竟他们有钱... - 惠新宸ᵀᴹ

26. 链接cdn谁家的？ 这种东西, 还是看谁财大气粗，网宿，51cache - 惠新宸ᵀᴹ

27. 链家在用aws，鸟哥的评价：配套的设施好, 工具好用

#### 关于网络攻击

1. 大部分遇到攻击导致客户项目挂掉是大量Ip进行攻击 - 陈玉龙

2. 攻击手段实在太多。你ddos 防护好， 就cc， syn攻击 之类的 - vk

3. CC攻击不能单纯依靠带宽防护，跟系统架构有关 - 陈玉龙

4. 达到超大量，已经和你系统架构无关了。  因为你的架构本来就不是做给这么大量访问的

5. 所以防火墙可以过滤这些，清洗出合理的量 - vk

6. 针对固定ip攻击的 防火墙可以很有效,看攻击者的投入了 - 陈玉龙

7. 去年国庆一直被攻击到清明之前。防火墙也用过阿里云 腾讯  杂牌 帝联,目前都死掉,剩下一家在用，还可以。就是cdn方面有bug

8. 通常攻击者投入资源越大 防御成本越高,下次遇到CC攻击可以@ 我,增加缓存隔离,能大幅降低防御成本

#### 关于培训

1. BAT 有很多人有简历洁癖，不喜欢要培训机构出来的人——因为他们觉得在大学都没有学好，还要去参加培训。说明这个人目标性不强
2. 学个编程，大学4年都学不好，网上这么多收费和免费的资源。说明这个人的自学能力有问题的 - 李文凯

#### 线上日志
问：请教大家一个问题：线上应用日志大家是怎么记录的，有没什么好的方案方便排查定位问题，以及发现潜在的危险。我这边现在是记录在log文件的，出了问题才去tail+grep - 小火箭

1. 做日志分析系统 有开源的吧,比如elk logio等 - 吴大锤

2. 前端收集工具很多，flume fluent rsyslog ,Fluent ruby插件很好开发,如果量大的话可以使用kafka 中间件,后面存储就随意了，磁盘，hdfs mongo,都行  - hello

3. 现在nginx的日志用的elk - 小火箭

4. 存储可以走es 搜索,定好日志格式 你现在有文件log 脚本扫描到es里面去 - 吴大锤

5. 对，其实进到kafka 后，至于后面是啥看需求,Es,hdfs,mongo 只不过是consumer 适配下就行了 - hello

6. kafka去拉日志物理文件的更新吗？还是直接写到kafka呢 - 高吴isCoding

7. Kafka 是push pull 的结构,他无状态 - hello

8. 看多大量，如果不大可以不上kafka - 钱志强

9. Producer 生产给kafka ,Consumer 消费message ,对，如果量不大没必要kafka -- hello

10. 嗯，这个生产者就扫描日志文件，然后推到队列，这样？- 高吴isCoding

11. 简单处理的的话直接logstash读log导入到es就可以了 - 小火箭

12. 是的,你先确定用什么log collectors - hello

13. fluentd也可以都行的,看需求，看喜好 - 钱志强

14. Rsyslog flume fluentd logstash ,对,还是看业务量 - hello


#### node主要应用到哪里？有大神分享一下吗？ - 李水祥

1. 我们拿node做实时推送的，用sockjs往网页上实时推送信息 - 朱建锋

2. 我们用nodejs做的文件上传的服务器 - 上吊de鱼

3. 好用吗？ - Today  
还可以，nodejs还是io有优势，有密集计算的最好别用，哪门语言都有坑 - 上吊de鱼

4. 写node要小心,我们之前出了个内存泄露的坑,找了很久才找到，到现在 还没有修干净 - 骑马爬树

5. 我觉得异常处理也是坑，一个处理不好，整个进程挂掉，正在处理的其他请求全部玩完。- 上吊de鱼

6. node是单进程的，为了利用多核，搞了个master，开多个worker，通过master调度到各个worker来实现的 - tiyee

#### 问一个菜鸟问题，群里大神给我解答一下，我们项目里，前端是php，后端是java，经常遇到php 请求某些java接口超时, 从而导致整个网站都挂, 在我认为一般情况只是某些请求挂了只是部分页面打不开，但实际上是整个php-fpm都挂了 - 朱政国

1. 一旦拥堵，如果访问量大，很快 backlog 就会耗尽，那就是整个挂掉，这种故障很常见 - 老王

2. 像这种情况 一般怎么做才能尽量避免全站都挂，之前是想把业务拆分，不同的业务不同的机器 - 朱政国

3. 可能拥堵的请求单独划分出去，不如用不同的服务器，或者不同的 pool - 老王

4. 是Swoole吗？ - tiyee  
不是哦  就我们普通的Php项目 - 朱政国

5. 另一个需要注意的是，java 程序一般缺省 backlog=50，也很容易爆掉 - 老王

6. 超时时间必须设置啊。。。 - 海中金

7. 错误捕获到不就好了吗？如果你们返回格式统一，就统一处理错误捕获，格式不一样就先哭一会，然后一个一个错误处理， - GHOST



#### 分享链接

1. [ Gopher大会slide分享 ]  (https://github.com/gopherchina/conference)

2. [ who is R大？ ]  (https://www.zhihu.com/people/rednaxelafx)

3. [ Go Bindings for the lua C API ]  (https://github.com/aarzilli/golua)

4. [ 为啥 Erlang 没有像 Go、Scala 语言那样崛起？ ]  (https://www.zhihu.com/question/38032439/answer/84176970)

5. [ Worse is better? ]  (http://robbinfan.com/blog/17/worse-is-better)

6. [ Golang写PHP扩展 ]  (https://github.com/Aimsam/go2php_trial)

7. [ 技能树 ]  (https://github.com/phodal)

8. [ 保证分布式系统数据一致性的6种方案 ]   (http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&mid=2653546976&idx=1&sn=c3fb2338389a41e7ab998c0c21bd3e5d&scene=1&srcid=0419dT1r9zkwodoE9ap7ZCgi#rd)

9. [ 程序员简历模板系列 ]  (https://github.com/geekcompany/ResumeSample)

10. [ Go设计模式 ]  (http://www.golangpatterns.info/)

11. [ 高速公路换轮胎——为遗留系统替换数据库 ]  (https://www.sdk.cn/news/3030)

12. [ 机器学习算法一览（附python和R代码） ]  (http://mp.weixin.qq.com/s?__biz=MjM5MTQzNzU2NA==&mid=2651640650&idx=1&sn=c905406e294cf2df5dcc2a3497ac3889&scene=1&srcid=04198K2zZ59QBig9qFaPoNJl#rd)

13. [ valyala/fasthttp —— 比官方库更快的 HTTP 包 ] (http://studygolang.com/articles/6792)

14. [ cedar-go：一个 Double-Array Trie 树的Go实现（直接用来过滤敏感词或分词） ]  (https://github.com/adamzy/cedar-go)

15. [ MySQL 的加锁处理分析 ]  (http://mp.weixin.qq.com/s?__biz=MjM5NTg2NTU0Ng==&mid=2656593348&idx=2&sn=fa4b470b3779008ba87ac55b86f57a47&scene=1&srcid=0416H7Uere7z9fgKoChgxX6A#wechat_redirect)

16. [ 参加Gopher北京大会是怎样的一种体验？ ]  (http://mp.weixin.qq.com/s?__biz=MjM5OTcxMzE0MQ==&mid=2653369699&idx=1&sn=8452b99cf2228da6443eef36f9360a75&scene=1&srcid=0419xQMrve7S8t9vs20xYC9y#wechat_redirect)

17. [ 在线教育平台上有哪些让你相见恨晚的计算机或互联网课程？ ]  (https://www.zhihu.com/question/29224038)

18. [ 程序员到底有多累、多辛苦？ ] (https://www.zhihu.com/question/39813913)	

