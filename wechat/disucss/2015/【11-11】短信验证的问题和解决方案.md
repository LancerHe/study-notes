> 转载自：<http://mp.weixin.qq.com/s?__biz=MzA3MDA2MjE2OQ==&amp;amp;mid=400570686&amp;amp;idx=1&amp;amp;sn=5288ba3069723b4cdcff124062842f17&amp;amp;scene=1&amp;amp%20;srcid=1112GBoDRUzAO9NSqV3M98nl#rd>

#### 今日话题

短信验证的问题和解决方案- 补鹏文

1. 问: [疑问]短信验证有啥问题？ - 陈亦  
回: 刷单的 一个手机绑n个号码 之前外卖团购之类很容易被刷单骗补贴，后来难受验证码直接改成拨打用户手机，语音播验证码 - Ericsuo
2. 语音验证码到达率貌似低点 - 木已成鲨鱼
3. 我们刚改成语音验证，貌似效果还可以，成本跟短信差不多 - rao
4. 短信验证码这个容易出安全问题，开发如果逻辑写的不严谨的话容易出现拿到一个验证码可以随意修改别人的密码的漏洞，验证码一定要有log，成经常会有客户反应收不到的情况，有log的话方便定位问题 - 姚文强
5. 最想知道的是，哪个服务商的到达率和到达速度好，我们用的是亿美，需要将近20秒才到 大家都用什么呢 - maxwell
6. 用过融联云通讯，感觉还行 - 风之缘
7. 易美还可以了,不过易美好像不是三网合一的通道 - shawnvan
8. 互忆无线 和云通讯 验证码通道 到达速度 到达率都不错。我们是双接口。出问题了后台可切换 - @理鱼
9. @shawnvan 说的是亿美软通吧？一个大坑。有接入后做测试，我还试过收到固话和手机发过来的验证码。到达率相当低。 - 倪鸣
10. 建议配合语音。都有可能挂。所以我建议你 至少双接口当成垃圾。你换什么都一样。毕竟是公用的 配合语音弄 - @理鱼
11. 以前用的时候偶发移动或联通手机总收不到短信 所以一个稳定的提供者很重要 有时候短信到手机了但是被安全软件拦截了，当成垃圾短信了 - 鲁猛
12. 被当成垃圾，主要可能是因为短信内容吧，含有垃圾短信过滤的关键词。 - 李三
13. 用户自主选择。如果收不到短信验证码，您可以选择接收语音验证码。[呲牙] - 金亮
14. @@理鱼 关于短信发送率和短信平台可用性检查会做检测的吗？双接口是怎么判定切换？ - 倪鸣  
回: 到达率。速度。只能通过定期自测。多接口。两个方式切换: 1监控触发。 2 人工切换配置, 开发的时候多通道需要自己程序封装, 比如 云通讯的 只需要模板id 不需要具体的模板内容。然后大多数是需要 接口传模板的, 这方面我折腾太多了, 报备过几百个模板的人。就是测试那些能过不能过, 每个提供商还不一样, 一个提供商 报备模板后  自己测试 用不同运营商的手机号码收, 测试几次 然后看到达时间 到达率 如果都能到达。实际使用也没撒问题, 最后请配合语音使用 - @理鱼
15. 云片在填模版时做关键词过滤，不用自己测试的呀。然后再报备。要不黑盒测关键词，一来一回效率太慢哦 - 倪鸣  
回: 一般不用这么折腾, 报备过的一般没问题, 不排除少部分。报备过得还是不行, 这个是被运营商过滤了。还有。一定别用群发通道。必须是验证码通道, 总之我这里的经验就是。 两家以上的短信提供商。 防止其中一个出问题。程序支持切换通道。后台管理切换，监控触发切换。语音验证码辅助 - @理鱼
16. @倪鸣 我们用的也是亿美，服务质量不行，你们后来用什么了 - maxwell  
回: @maxwell 云片, 不过可以像 @@理鱼 说的，做双接入, 他们的后台查询比较好，Api文档还算全。而且似乎是按发送成功的才扣量。亿美是不管怎样，你提交就扣量，连发送状态没得跟踪。一个觉得还算不错的切换策略是，用户没收到验证码，第二次点发送验证码，切换另外一个短信接口发送。再不行换语音验证码 - 倪鸣
17. 问: @倪鸣 嗯，云片速度如何，约几秒  - 刘天昭  
回: 我测试的时候都很快。你最好自己申请试试。他有测试条数，好像是10条。对了，有一些短信平台有起充量，你可以对比下 - 倪鸣
18. 问: @倪鸣 每次用户点击按钮的时候是不是还要对比下上次发送的内容 以及是否发送成功？  
基本都会有10来条的测试资源，但是测试的时候不知道是不是有什么优先设置，我的感觉是测试的时候基本都会很快到达，但是真正使用的时候到达率就低了 - 涵戈  
回: 一般都是按模版Id控制发送，不用对比内容，对比模版id。同个手机号，同个Ip频率要控制，不然被恶意利用。有些短信平台会这样，呵呵，所谓的优先通道。除非程序内部流程触发通知短信，面对用户的得加验证码，频率控制。短信平台的短信量要有告警阈值。有些平台会偷扣量，群发的那种，有一些用户是收不到的。自己得有在里面加些验证手机。 - 倪鸣
19. 及时性问题。问题就是验证码发出去了，用户没收到。然后用户不停的重试，最后N条堆积了好久才收到，我们的解决方案是 换了几家更靠谱的运营商。别无他法。 - 如末
20. 你们用的什么短信运营商  我们前几天用了个短信运营商  结果说短信被举报了  导致短信收不到 - 陈阳
21. 有些短信商不能发带有营销类的信息，要发，还得先定好模板才能发 - Mr.li
22. 怎么解决打码平台以及手机验证码平台，说白了是如何提升恶意用户的成本，没有完美解决方案，当恶意用户在你的项目所获得的有效收益跟他们的使用成本在某个比例的时候他们就会选择放弃 - 林志勇
23. 先发好自己的队列。再在队列中去发到短信平台，我们用node 异步取redis 速度很快 - 如末
24. 昨天双十一我们平台也跪咯，双十一短信服务商也忙不过来，我觉得短信主要问题有：1，找一家靠谱的服务商，最好提供子端口，以前用国都，现在梦网，差的广告商常常被拦截。2，避免刷短信，验证码或者自己记录发送频率。3，重试机制，也是这个群里某位教我的，启用语音或者每次请求有不同子通道或者服务商。4，实现方式使用异步队列，可能还需要优先级。5，用MongoDB存储发送记录和回复记录。后两点还在摸索中，估计有坑的 - pengVin
25. 短信的提供商都收到电信商的限制，有些字早就就黑名单了。比如说付款，钱，所有接口都接在运营商上，运营商的机制就是，我让你发你才能发，如果出现黑字，他不会告诉你，你自己需要察觉，早期我们用的也是第三方平台，诸多限制 - 李子
26. 还有如果用户发送了TD(退订),服务商就自动忽略这个用户.类似黑名单 - pengVin
27. 前两天。我们公司发的短信里面的验证码。有av两个字母。结果被屏蔽了 - 熊mao
28. 中国移动这里就有短信策略，发了敏感词汇，直接关闭短信功能，或者直接功能性停机 - 果冻

#### 分享链接

1. 干货 | 10个顶尖公司的高可用架构实践案例分析 https://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&mid=401134486&idx=1&sn=c0b99b81dd52abf450f3a86e7b025552 - 轻裘长剑
2. 谷歌今天将其人工智能引擎开源了 http://mp.weixin.qq.com/s?__biz=MzA3NDU2NDk3MQ==&mid=400966666&idx=1&sn=d72d369c5aad9297f92b025889a91d3f - 陈亦
3. 美团在Redis上踩过的一些坑-5.redis cluster遇到的一些问题 http://carlosfu.iteye.com/blog/2254573 - 黑夜路人
4. PHP7什么时候发布 http://mp.weixin.qq.com/s?__biz=MzIwNDExMjIzNA==&mid=400482841&idx=1&sn=6809e6630b9d7f024a736e2e9779a804 - 惠新宸
5. 这是PHP之父, Rasmus Lerdorf在台湾的演讲, 对PHP7的性能表现做了很多的对比测试，对PHP7性能关心的同学可以看看. PPT地址：http://talks.php.net/taiwan15#/ - 惠新宸
6. 【鹅厂网事】大型互联网公司海量监控系统设计 http://mp.weixin.qq.com/s?__biz=MzA3ODgyNzcwMw==&mid=208721332&idx=1&sn=e7159a0da349be78858f1098b133f330 - @理鱼
7. Linux下select, poll和epoll IO模型的详解 http://blog.csdn.net/tianmohust/article/details/6677985 - 罗金龙
8. 你的redis端口有acl吗？你的redis有密码吗？赶紧去加吧[呲牙] http://weibo.com/5705824788/D3kEEwlH4 - 钱志强
9. Kafka 高性能吞吐揭秘 http://mp.weixin.qq.com/s?__biz=MzIwMDQ3NDE0Ng==&mid=400403507&idx=1&sn=999cec68fdc3b856b742897413112789 - 黑夜路人
10. MySQL索引原理及慢查询优化 http://tech.meituan.com/mysql-index.html - kdrol.li